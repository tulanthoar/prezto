function sudo-command-line()
{
    if [[ "$BUFFER" != su(do|)\ * && -n "$BUFFER" ]]; then
        BUFFER="sudo $BUFFER"
            (( CURSOR += 5 ))
            return
            else
            [[ $BUFFER == sudo\ * ]] && BUFFER=${BUFFER#sudo}
            fi
            [[ -z "$BUFFER" ]] && zle history-substring-search-up
            zle -R
              BUFFER="sudo $BUFFER"
              (( CURSOR += 5 ))
}
